{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Public Transport Integration for Home Assistant","text":"<p>A Home Assistant integration for real-time public transport departure information across multiple European transit networks.</p>"},{"location":"#supported-providers","title":"Supported Providers","text":"Provider Region API Key Required VRR Verkehrsverbund Rhein-Ruhr (NRW, Germany) No KVV Karlsruher Verkehrsverbund (Germany) No HVV Hamburger Verkehrsverbund (Germany) No Trafiklab Sweden (nationwide) Yes (free) NTA National Transport Authority (Ireland) Yes (free)"},{"location":"#features","title":"Features","text":""},{"location":"#core-features","title":"Core Features","text":"<ul> <li>Smart Setup Wizard - Intuitive multi-step configuration with autocomplete for locations and stops</li> <li>Real-time Departures - Shows current departure times with delays</li> <li>Multiple Transport Types - Supports trains (ICE, IC, RE), subway, trams, and buses</li> <li>Smart Filtering - Filter by specific transportation types</li> <li>Binary Sensor for Delays - Automatic detection of delays &gt; 5 minutes</li> <li>Device Support - Entities are grouped together with suggested areas</li> <li>Repair Issues Integration - Automatic notifications for API errors or rate limits</li> <li>Rate Limiting - Intelligent API rate limiting to prevent overload</li> <li>Timezone Support - Proper handling of provider-specific timezones</li> </ul>"},{"location":"#intelligence-performance-features","title":"Intelligence &amp; Performance Features","text":"<ul> <li>Fuzzy Matching with Typo Tolerance - Intelligently finds stops even with typos<ul> <li>Handles common misspellings: \"Hauptbanhof\" \u2192 \"Hauptbahnhof\"</li> <li>German umlaut normalization: \"Dusseldorf\" \u2192 \"D\u00fcsseldorf\"</li> </ul> </li> <li>API Response Caching - 5-minute intelligent cache reduces API load</li> <li>Optimized Sensor Performance - 20-30% faster departure processing</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<ol> <li>Install via HACS (recommended) or manually</li> <li>Add the integration via Settings &gt; Devices &amp; Services &gt; Add Integration</li> <li>Search for \"VRR\" or \"Public Transport Departures\"</li> <li>Follow the setup wizard to configure your stops</li> </ol>"},{"location":"#transportation-types","title":"Transportation Types","text":"<p>The integration supports the following transport types:</p> Type Icon Description <code>train</code> :material-train: Trains (ICE, IC, RE, RB) <code>subway</code> :material-subway-variant: Subway/Metro (U-Bahn) <code>tram</code> :material-tram: Tram/Streetcar <code>bus</code> :material-bus: Bus <code>ferry</code> :material-ferry: Ferry <code>taxi</code> :material-taxi: Taxi"},{"location":"#license","title":"License","text":"<p>This project is licensed under the MIT License.</p>"},{"location":"#support","title":"Support","text":"<p>For issues or questions:</p> <ol> <li>Check the Troubleshooting guide</li> <li>Search existing GitHub Issues</li> <li>Create a new issue with debug information</li> </ol>"},{"location":"automations/","title":"Automations","text":"<p>This page provides automation examples for the Public Transport Integration.</p>"},{"location":"automations/#refresh-departures","title":"Refresh Departures","text":""},{"location":"automations/#refresh-when-arriving-home","title":"Refresh When Arriving Home","text":"<p>Automatically refresh departure data when you arrive home.</p> <pre><code>automation:\n  - alias: \"Refresh departures when arriving home\"\n    trigger:\n      - platform: state\n        entity_id: person.john\n        to: home\n    action:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"automations/#refresh-before-morning-commute","title":"Refresh Before Morning Commute","text":"<p>Refresh data before your morning commute on weekdays.</p> <pre><code>automation:\n  - alias: \"Refresh departures before commute\"\n    trigger:\n      - platform: time\n        at: \"07:00:00\"\n    condition:\n      - condition: time\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"automations/#delay-notifications","title":"Delay Notifications","text":""},{"location":"automations/#notify-on-significant-delays","title":"Notify on Significant Delays","text":"<p>Send a notification when delays exceed 5 minutes.</p> <pre><code>automation:\n  - alias: \"Notify on train delays\"\n    trigger:\n      - platform: state\n        entity_id: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n        to: \"on\"\n    action:\n      - service: notify.mobile_app\n        data:\n          title: \"Train Delays\"\n          message: &gt;\n            Delays detected at {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'station_name') }}.\n            Maximum delay: {{ state_attr('binary_sensor.vrr_dusseldorf_hauptbahnhof_delays', 'max_delay') }} minutes.\n</code></pre>"},{"location":"automations/#morning-delay-alert","title":"Morning Delay Alert","text":"<p>Alert you about delays during your commute time.</p> <pre><code>automation:\n  - alias: \"Morning commute delay alert\"\n    trigger:\n      - platform: state\n        entity_id: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n        to: \"on\"\n    condition:\n      - condition: time\n        after: \"06:30:00\"\n        before: \"09:00:00\"\n      - condition: time\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: notify.mobile_app\n        data:\n          title: \"\u26a0\ufe0f Commute Delay\"\n          message: &gt;\n            Your train may be delayed. Check before leaving!\n</code></pre>"},{"location":"automations/#departure-reminders","title":"Departure Reminders","text":""},{"location":"automations/#remind-to-leave","title":"Remind to Leave","text":"<p>Remind you when it's time to leave for the station.</p> <pre><code>automation:\n  - alias: \"Time to leave reminder\"\n    trigger:\n      - platform: template\n        value_template: &gt;\n          {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') | int &lt;= 15 }}\n    condition:\n      - condition: state\n        entity_id: person.john\n        state: home\n    action:\n      - service: notify.mobile_app\n        data:\n          title: \"Time to Leave!\"\n          message: &gt;\n            Your train leaves in {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} minutes.\n            Line: {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].line }}\n</code></pre>"},{"location":"automations/#smart-departure-alert","title":"Smart Departure Alert","text":"<p>Factor in walking time to the station.</p> <pre><code>automation:\n  - alias: \"Smart departure alert\"\n    trigger:\n      - platform: template\n        value_template: &gt;\n          {% set walk_time = 10 %}\n          {% set buffer = 5 %}\n          {% set mins = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') | int %}\n          {{ mins &lt;= (walk_time + buffer) and mins &gt; 0 }}\n    condition:\n      - condition: state\n        entity_id: person.john\n        state: home\n      - condition: time\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: notify.mobile_app\n        data:\n          title: \"\ud83d\ude89 Leave Now!\"\n          message: &gt;\n            Train departs in {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} min.\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].line }} \u2192\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].destination }}\n</code></pre>"},{"location":"automations/#display-automations","title":"Display Automations","text":""},{"location":"automations/#show-departure-on-smart-display","title":"Show Departure on Smart Display","text":"<p>Update a smart display or tablet with departure info.</p> <pre><code>automation:\n  - alias: \"Update departure display\"\n    trigger:\n      - platform: state\n        entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n    action:\n      - service: input_text.set_value\n        target:\n          entity_id: input_text.next_departure\n        data:\n          value: &gt;\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].line }} at\n            {{ states('sensor.vrr_dusseldorf_hauptbahnhof') }}\n</code></pre>"},{"location":"automations/#tts-announcement","title":"TTS Announcement","text":"<p>Announce the next departure via text-to-speech.</p> <pre><code>automation:\n  - alias: \"Announce next departure\"\n    trigger:\n      - platform: time\n        at: \"07:30:00\"\n    condition:\n      - condition: time\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: tts.speak\n        target:\n          entity_id: tts.google_translate\n        data:\n          message: &gt;\n            {% set dep = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0] %}\n            Your next train is line {{ dep.line }} to {{ dep.destination }}\n            departing at {{ dep.departure_time }}{% if dep.delay &gt; 0 %}, delayed by {{ dep.delay }} minutes{% endif %}.\n</code></pre>"},{"location":"automations/#template-sensors-for-automations","title":"Template Sensors for Automations","text":"<p>Create helper sensors for easier automations.</p> <pre><code>template:\n  - sensor:\n      - name: \"Next Train Minutes\"\n        state: &gt;\n          {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }}\n        unit_of_measurement: \"min\"\n        icon: mdi:clock-outline\n\n      - name: \"Next Train Line\"\n        state: &gt;\n          {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n          {% if departures and departures|length &gt; 0 %}\n            {{ departures[0].line }}\n          {% else %}\n            -\n          {% endif %}\n        icon: mdi:train\n\n      - name: \"Next Train Destination\"\n        state: &gt;\n          {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n          {% if departures and departures|length &gt; 0 %}\n            {{ departures[0].destination }}\n          {% else %}\n            -\n          {% endif %}\n        icon: mdi:map-marker\n\n      - name: \"Train Status\"\n        state: &gt;\n          {% if is_state('binary_sensor.vrr_dusseldorf_hauptbahnhof_delays', 'on') %}\n            Delayed\n          {% else %}\n            On Time\n          {% endif %}\n        icon: &gt;\n          {% if is_state('binary_sensor.vrr_dusseldorf_hauptbahnhof_delays', 'on') %}\n            mdi:alert-circle\n          {% else %}\n            mdi:check-circle\n          {% endif %}\n</code></pre>"},{"location":"automations/#scripts","title":"Scripts","text":""},{"location":"automations/#departure-info-script","title":"Departure Info Script","text":"<p>A reusable script to get departure information.</p> <pre><code>script:\n  get_next_departure:\n    alias: \"Get Next Departure\"\n    sequence:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n      - delay:\n          seconds: 2\n      - service: notify.mobile_app\n        data:\n          title: \"Next Departure\"\n          message: &gt;\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].line }} \u2192\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures')[0].destination }}\n            at {{ states('sensor.vrr_dusseldorf_hauptbahnhof') }}\n            (in {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} min)\n</code></pre>"},{"location":"configuration/","title":"Configuration","text":"<p>The integration uses an intuitive multi-step setup wizard with autocomplete functionality.</p>"},{"location":"configuration/#setup-wizard","title":"Setup Wizard","text":""},{"location":"configuration/#step-1-select-provider","title":"Step 1: Select Provider","text":"<p>Choose your transit provider:</p> <ul> <li>VRR - Verkehrsverbund Rhein-Ruhr (NRW, Germany)</li> <li>KVV - Karlsruher Verkehrsverbund (Germany)</li> <li>HVV - Hamburger Verkehrsverbund (Hamburg, Germany)</li> <li>Trafiklab - Sweden (nationwide)</li> <li>NTA - National Transport Authority (Ireland)</li> </ul> <p>Note</p> <p>Trafiklab and NTA require a free API key. You'll be prompted to enter it in the next step.</p>"},{"location":"configuration/#step-2-api-key-if-required","title":"Step 2: API Key (if required)","text":"<p>For Trafiklab and NTA providers, you'll need to enter your API key.</p> <p>See the provider-specific documentation for instructions:</p> <ul> <li>Trafiklab API Key</li> <li>NTA API Key</li> </ul>"},{"location":"configuration/#step-3-search-for-stop","title":"Step 3: Search for Stop","text":"<p>Enter your stop/station name. The integration will search and suggest matching stops.</p> <p>Tips for better search results:</p> <ul> <li>Enter the city name along with the stop name (e.g., \"D\u00fcsseldorf Hauptbahnhof\")</li> <li>The search handles typos and umlaut variations automatically</li> <li>For Swedish/Irish stops, use local naming conventions</li> </ul>"},{"location":"configuration/#step-4-select-stop","title":"Step 4: Select Stop","text":"<p>If multiple stops match your search, you'll be presented with a list to choose from. Each entry shows:</p> <ul> <li>Stop name</li> <li>City/place (in parentheses)</li> </ul>"},{"location":"configuration/#step-5-configure-settings","title":"Step 5: Configure Settings","text":"Setting Default Range Description Number of departures 10 1-20 How many departures to fetch Transportation types All Multi-select Filter by transport type Scan interval 60 10-3600 seconds How often to update Use provider logo Off On/Off Show provider logo instead of transport icon"},{"location":"configuration/#adding-multiple-stops","title":"Adding Multiple Stops","text":"<p>To monitor multiple stops:</p> <ol> <li>Go to Settings &gt; Devices &amp; Services</li> <li>Find the \"VRR\" integration</li> <li>Click Add Entry</li> <li>Follow the setup wizard again</li> </ol> <p>Each stop will create its own sensor and binary sensor entities.</p>"},{"location":"configuration/#modifying-settings","title":"Modifying Settings","text":"<p>After initial setup, you can modify settings:</p> <ol> <li>Go to Settings &gt; Devices &amp; Services</li> <li>Find your stop entry</li> <li>Click Configure</li> <li>Adjust settings as needed</li> </ol> <p>Tip</p> <p>You can change:</p> <ul> <li>Number of departures</li> <li>Transportation type filter</li> <li>Scan interval</li> <li>Provider logo display</li> </ul>"},{"location":"configuration/#configuration-options-reference","title":"Configuration Options Reference","text":""},{"location":"configuration/#number-of-departures","title":"Number of Departures","text":"<p>Controls how many upcoming departures are fetched from the API.</p> <ul> <li>Minimum: 1</li> <li>Maximum: 20</li> <li>Recommended: 5-10</li> </ul> <p>Higher values provide more information but increase API usage.</p>"},{"location":"configuration/#transportation-types","title":"Transportation Types","text":"<p>Filter departures by transport type:</p> Type Description <code>train</code> All trains (ICE, IC, RE, RB) <code>subway</code> Subway/Metro (U-Bahn) <code>tram</code> Tram/Streetcar <code>bus</code> All bus types <code>ferry</code> Ferry services <code>taxi</code> Taxi/On-demand"},{"location":"configuration/#scan-interval","title":"Scan Interval","text":"<p>How often the integration fetches new data from the API.</p> <ul> <li>Minimum: 10 seconds</li> <li>Maximum: 3600 seconds (1 hour)</li> <li>Recommended: 60-120 seconds</li> </ul> <p>Warning</p> <p>Setting very low intervals may trigger rate limiting on some providers.</p>"},{"location":"configuration/#use-provider-logo","title":"Use Provider Logo","text":"<p>When enabled, the entity picture shows the provider's logo instead of the dynamic transport type icon.</p>"},{"location":"dashboard/","title":"Dashboard Examples","text":"<p>This page provides various Lovelace dashboard examples for displaying departure information.</p>"},{"location":"dashboard/#simple-entities-card","title":"Simple Entities Card","text":"<p>A basic card showing the sensor state and key attributes.</p> <pre><code>type: entities\ntitle: D\u00fcsseldorf Hauptbahnhof\nentities:\n  - entity: sensor.vrr_dusseldorf_hauptbahnhof\n    name: Next Departure\n  - type: attribute\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: next_departure_minutes\n    name: In Minutes\n    suffix: min\n  - type: attribute\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: total_departures\n    name: Available Connections\n</code></pre>"},{"location":"dashboard/#markdown-card-with-departures-list","title":"Markdown Card with Departures List","text":"<p>A detailed view showing multiple departures with delay information.</p> <pre><code>type: markdown\ntitle: Departures - Hauptbahnhof\ncontent: &gt;\n  {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n\n  {% if departures %}\n    {% for departure in departures[:5] %}\n      **{{ departure.line }}** \u2192 {{ departure.destination }}\n      \ud83d\udd50 {{ departure.departure_time }} {% if departure.delay &gt; 0 %}(+{{ departure.delay }} min){% endif %}\n      \ud83d\udccd Platform {{ departure.platform }}\n\n    {% endfor %}\n  {% else %}\n    No departures available\n  {% endif %}\n</code></pre>"},{"location":"dashboard/#table-format-with-markdown","title":"Table Format with Markdown","text":"<p>A clean table layout for departures.</p> <pre><code>type: markdown\ntitle: \ud83d\ude89 Departures\ncontent: &gt;\n  {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n\n  {% if departures %}\n    | Line | Destination | Time | Platform |\n    |------|-------------|------|----------|\n    {% for dep in departures[:5] %}\n    | **{{ dep.line }}** | {{ dep.destination }} | {{ dep.departure_time }}{% if dep.delay &gt; 0 %} &lt;font color=\"red\"&gt;(+{{ dep.delay }})&lt;/font&gt;{% endif %} | {{ dep.platform }} |\n    {% endfor %}\n  {% endif %}\n</code></pre>"},{"location":"dashboard/#custom-button-card-for-manual-refresh","title":"Custom Button Card for Manual Refresh","text":"<p>A button to manually refresh departure data.</p> <pre><code>type: button\nname: Refresh Departures\nicon: mdi:refresh\ntap_action:\n  action: call-service\n  service: vrr.refresh_departures\n  service_data:\n    entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"dashboard/#mushroom-chips-card","title":"Mushroom Chips Card","text":"<p>Using Mushroom cards for a compact display.</p> <pre><code>type: custom:mushroom-chips-card\nchips:\n  - type: entity\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    icon: mdi:train\n    content_info: state\n  - type: template\n    icon: mdi:clock-outline\n    content: &gt;\n      {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} min\n  - type: template\n    icon: mdi:refresh\n    tap_action:\n      action: call-service\n      service: vrr.refresh_departures\n</code></pre>"},{"location":"dashboard/#conditional-card","title":"Conditional Card","text":"<p>Only show if departure is soon (less than 10 minutes).</p> <pre><code>type: conditional\nconditions:\n  - condition: numeric_state\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: next_departure_minutes\n    below: 10\ncard:\n  type: markdown\n  content: &gt;\n    \u26a0\ufe0f **Attention!** Your train leaves in {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} minutes!\n</code></pre>"},{"location":"dashboard/#auto-entities-with-template-entity-row","title":"Auto-Entities with Template Entity Row","text":"<p>Dynamic list using auto-entities and template-entity-row custom cards.</p> <p>Requirements</p> <p>This example requires the custom cards:</p> <ul> <li>auto-entities</li> <li>template-entity-row</li> </ul> <pre><code>type: custom:auto-entities\ncard:\n  type: entities\n  title: All Departures\nfilter:\n  template: &gt;\n    {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n\n    {% for departure in departures %}\n      {{\n        {\n          'type': 'custom:template-entity-row',\n          'name': departure.line + ' \u2192 ' + departure.destination,\n          'icon': 'mdi:train',\n          'state': departure.departure_time,\n          'secondary': 'Platform ' + departure.platform + ' | in ' + departure.minutes_until_departure|string + ' min'\n        }\n      }},\n    {% endfor %}\n</code></pre>"},{"location":"dashboard/#full-dashboard-example","title":"Full Dashboard Example","text":"<p>A comprehensive vertical stack combining multiple elements.</p> <pre><code>type: vertical-stack\ncards:\n  - type: markdown\n    title: \ud83d\ude89 D\u00fcsseldorf Hauptbahnhof\n    content: &gt;\n      Next departure: **{{ states('sensor.vrr_dusseldorf_hauptbahnhof') }}**\n\n      In {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} minutes\n\n  - type: custom:mushroom-chips-card\n    chips:\n      - type: entity\n        entity: sensor.vrr_dusseldorf_hauptbahnhof\n        icon: mdi:train\n        content_info: state\n      - type: template\n        icon: mdi:clock-outline\n        content: &gt;\n          {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} min\n      - type: template\n        icon: mdi:refresh\n        tap_action:\n          action: call-service\n          service: vrr.refresh_departures\n\n  - type: markdown\n    content: &gt;\n      {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n\n      {% if departures %}\n        | Line | Destination | Time | Platform |\n        |------|-------------|------|----------|\n        {% for dep in departures[:5] %}\n        | **{{ dep.line }}** | {{ dep.destination }} | {{ dep.departure_time }}{% if dep.delay &gt; 0 %} &lt;font color=\"red\"&gt;(+{{ dep.delay }})&lt;/font&gt;{% endif %} | {{ dep.platform }} |\n        {% endfor %}\n      {% endif %}\n</code></pre>"},{"location":"dashboard/#delay-status-card","title":"Delay Status Card","text":"<p>Show delay status with the binary sensor.</p> <pre><code>type: entities\ntitle: Delay Status\nentities:\n  - entity: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n    name: Delays Detected\n  - type: attribute\n    entity: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n    attribute: delayed_departures\n    name: Delayed\n  - type: attribute\n    entity: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n    attribute: max_delay\n    name: Max Delay\n    suffix: min\n  - type: attribute\n    entity: binary_sensor.vrr_dusseldorf_hauptbahnhof_delays\n    attribute: average_delay\n    name: Average Delay\n    suffix: min\n</code></pre>"},{"location":"dashboard/#statistics-card","title":"Statistics Card","text":"<p>Display departure statistics.</p> <pre><code>type: glance\ntitle: Station Statistics\nentities:\n  - entity: sensor.vrr_dusseldorf_hauptbahnhof\n    name: Next\n  - type: attribute\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: total_departures\n    name: Total\n  - type: attribute\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: delayed_count\n    name: Delayed\n  - type: attribute\n    entity: sensor.vrr_dusseldorf_hauptbahnhof\n    attribute: on_time_count\n    name: On Time\n</code></pre>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#hacs-installation-recommended","title":"HACS Installation (Recommended)","text":"<p>HACS (Home Assistant Community Store) is the recommended installation method.</p>"},{"location":"installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Home Assistant 2024.1 or newer</li> <li>HACS installed and configured</li> </ul>"},{"location":"installation/#steps","title":"Steps","text":"<ol> <li>Open HACS in Home Assistant</li> <li>Go to Integrations</li> <li>Click the three dots in the top right and select Custom repositories</li> <li>Add this repository URL: <code>https://github.com/NerdySoftPaw/hacs-publictransport</code></li> <li>Select Integration as category</li> <li>Click Add</li> <li>Search for \"Public\" and install the integration</li> <li>Restart Home Assistant</li> </ol> <p>Tip</p> <p>After installation, the integration will appear in your list of available integrations.</p>"},{"location":"installation/#manual-installation","title":"Manual Installation","text":"<p>If you prefer not to use HACS, you can install the integration manually.</p>"},{"location":"installation/#steps_1","title":"Steps","text":"<ol> <li>Download the latest release from GitHub Releases</li> <li>Extract the <code>custom_components/vrr</code> folder</li> <li>Copy the folder to your Home Assistant <code>custom_components</code> directory:    <pre><code>&lt;config&gt;/custom_components/vrr/\n</code></pre></li> <li>Restart Home Assistant</li> </ol>"},{"location":"installation/#directory-structure","title":"Directory Structure","text":"<p>After installation, your directory should look like this:</p> <pre><code>custom_components/\n\u2514\u2500\u2500 vrr/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 binary_sensor.py\n    \u251c\u2500\u2500 config_flow.py\n    \u251c\u2500\u2500 const.py\n    \u251c\u2500\u2500 manifest.json\n    \u251c\u2500\u2500 sensor.py\n    \u251c\u2500\u2500 services.yaml\n    \u251c\u2500\u2500 strings.json\n    \u2514\u2500\u2500 providers/\n        \u251c\u2500\u2500 __init__.py\n        \u251c\u2500\u2500 base.py\n        \u251c\u2500\u2500 hvv.py\n        \u251c\u2500\u2500 kvv.py\n        \u251c\u2500\u2500 nta.py\n        \u251c\u2500\u2500 trafiklab.py\n        \u2514\u2500\u2500 vrr.py\n</code></pre>"},{"location":"installation/#verify-installation","title":"Verify Installation","text":"<p>After restarting Home Assistant:</p> <ol> <li>Go to Settings &gt; Devices &amp; Services</li> <li>Click + Add Integration</li> <li>Search for \"VRR\" or \"Public Transport Departures\"</li> </ol> <p>If the integration appears in the list, installation was successful.</p>"},{"location":"installation/#updating","title":"Updating","text":""},{"location":"installation/#hacs-updates","title":"HACS Updates","text":"<p>HACS will notify you when updates are available. Simply click Update and restart Home Assistant.</p>"},{"location":"installation/#manual-updates","title":"Manual Updates","text":"<ol> <li>Download the latest release</li> <li>Replace all files in <code>custom_components/vrr/</code></li> <li>Restart Home Assistant</li> </ol> <p>Warning</p> <p>Always backup your configuration before updating.</p>"},{"location":"sensors/","title":"Sensors &amp; Attributes","text":"<p>The integration creates two entity types for each configured stop: a Sensor for departure information and a Binary Sensor for delay detection.</p>"},{"location":"sensors/#sensor-entity","title":"Sensor Entity","text":""},{"location":"sensors/#state","title":"State","text":"<p>The sensor's state is the departure time of the next departure (e.g., \"14:35\") or \"No departures\" if none are available.</p>"},{"location":"sensors/#icon","title":"Icon","text":"<p>The icon dynamically changes based on the transportation type of the next departure:</p> Transport Type Icon bus mdi:bus-clock tram mdi:tram subway mdi:subway-variant train mdi:train ferry mdi:ferry taxi mdi:taxi on_demand mdi:bus-alert"},{"location":"sensors/#entity-picture","title":"Entity Picture","text":"<p>If \"Use provider logo\" is enabled in options, the entity displays the provider's logo instead of the dynamic icon.</p>"},{"location":"sensors/#attributes","title":"Attributes","text":"Attribute Type Description <code>departures</code> List Full list of upcoming departures <code>next_3_departures</code> List Simplified list of next 3 departures <code>station_name</code> String Name of the station <code>station_id</code> String Station ID <code>last_updated</code> DateTime Last successful update time <code>next_departure_minutes</code> Integer Minutes until next departure <code>total_departures</code> Integer Number of departures in list <code>delayed_count</code> Integer Count of delayed departures <code>on_time_count</code> Integer Count of on-time departures <code>average_delay</code> Float Average delay in minutes <code>earliest_departure</code> String Time of earliest departure (HH:MM) <code>latest_departure</code> String Time of latest departure (HH:MM)"},{"location":"sensors/#departure-object-structure","title":"Departure Object Structure","text":"<p>Each departure in the <code>departures</code> list contains:</p> Field Type Description <code>line</code> String Line number/name (e.g., \"U1\", \"RE5\", \"Bus 42\") <code>destination</code> String Final destination <code>departure_time</code> String Actual/estimated departure time (HH:MM) <code>planned_time</code> String Scheduled departure time (HH:MM) <code>delay</code> Integer Delay in minutes (0 if on time) <code>platform</code> String Platform/track number <code>transportation_type</code> String Type: bus, train, tram, subway, ferry, taxi <code>is_realtime</code> Boolean Whether real-time data is available <code>minutes_until_departure</code> Integer Minutes until departure <code>description</code> String Route description (optional) <code>agency</code> String Operating agency (NTA only)"},{"location":"sensors/#example-attribute-data","title":"Example Attribute Data","text":"<pre><code>{\n  \"departures\": [\n    {\n      \"line\": \"U79\",\n      \"destination\": \"D\u00fcsseldorf Hbf\",\n      \"departure_time\": \"14:35\",\n      \"planned_time\": \"14:33\",\n      \"delay\": 2,\n      \"platform\": \"1\",\n      \"transportation_type\": \"subway\",\n      \"is_realtime\": true,\n      \"minutes_until_departure\": 5\n    },\n    {\n      \"line\": \"RE5\",\n      \"destination\": \"Koblenz Hbf\",\n      \"departure_time\": \"14:42\",\n      \"planned_time\": \"14:42\",\n      \"delay\": 0,\n      \"platform\": \"3\",\n      \"transportation_type\": \"train\",\n      \"is_realtime\": true,\n      \"minutes_until_departure\": 12\n    }\n  ],\n  \"next_3_departures\": [...],\n  \"station_name\": \"D\u00fcsseldorf - Hauptbahnhof\",\n  \"station_id\": \"20018235\",\n  \"last_updated\": \"2025-01-22T14:30:00+01:00\",\n  \"next_departure_minutes\": 5,\n  \"total_departures\": 10,\n  \"delayed_count\": 3,\n  \"on_time_count\": 7,\n  \"average_delay\": 2.3,\n  \"earliest_departure\": \"14:35\",\n  \"latest_departure\": \"15:15\"\n}\n</code></pre>"},{"location":"sensors/#binary-sensor-entity","title":"Binary Sensor Entity","text":"<p>The binary sensor indicates whether there are significant delays at the stop.</p>"},{"location":"sensors/#state_1","title":"State","text":"<ul> <li>On (Problem): At least one departure has a delay &gt; 5 minutes</li> <li>Off (OK): All departures are on time or have minor delays</li> </ul>"},{"location":"sensors/#device-class","title":"Device Class","text":"<p><code>problem</code> - Displays as a problem indicator in the Home Assistant UI.</p>"},{"location":"sensors/#icon_1","title":"Icon","text":"State Icon On (delayed) mdi:alert-circle Off (on time) mdi:check-circle"},{"location":"sensors/#attributes_1","title":"Attributes","text":"Attribute Type Description <code>delayed_departures</code> Integer Count of delayed departures <code>on_time_departures</code> Integer Count of on-time departures <code>average_delay</code> Float Average delay in minutes <code>max_delay</code> Integer Maximum delay in minutes <code>total_departures</code> Integer Total number of departures <code>delays_list</code> List First 10 delay values <code>delay_threshold</code> Integer Threshold for triggering (5 minutes)"},{"location":"sensors/#example","title":"Example","text":"<pre><code>{\n  \"delayed_departures\": 2,\n  \"on_time_departures\": 8,\n  \"average_delay\": 3.5,\n  \"max_delay\": 12,\n  \"total_departures\": 10,\n  \"delays_list\": [12, 3],\n  \"delay_threshold\": 5\n}\n</code></pre>"},{"location":"sensors/#device-grouping","title":"Device Grouping","text":"<p>Both entities are grouped under a single device:</p> <ul> <li>Device Name: <code>{place} - {stop_name}</code></li> <li>Manufacturer: <code>{PROVIDER} Public Transport</code></li> <li>Model: <code>Departure Monitor</code></li> <li>Suggested Area: The city/place name</li> </ul> <p>This grouping makes it easy to manage multiple stops and see all related entities together.</p>"},{"location":"sensors/#template-sensor-examples","title":"Template Sensor Examples","text":""},{"location":"sensors/#minutes-until-departure","title":"Minutes Until Departure","text":"<pre><code>template:\n  - sensor:\n      - name: \"Next Train Minutes\"\n        state: &gt;\n          {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }}\n        unit_of_measurement: \"min\"\n        icon: mdi:clock-outline\n</code></pre>"},{"location":"sensors/#next-line-number","title":"Next Line Number","text":"<pre><code>template:\n  - sensor:\n      - name: \"Next Train Line\"\n        state: &gt;\n          {% set departures = state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'departures') %}\n          {% if departures and departures|length &gt; 0 %}\n            {{ departures[0].line }}\n          {% else %}\n            -\n          {% endif %}\n        icon: mdi:train\n</code></pre>"},{"location":"sensors/#delayed-departure-count","title":"Delayed Departure Count","text":"<pre><code>template:\n  - sensor:\n      - name: \"Delayed Departures\"\n        state: &gt;\n          {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'delayed_count') }}\n        unit_of_measurement: \"departures\"\n        icon: mdi:clock-alert\n</code></pre>"},{"location":"services/","title":"Services","text":"<p>The integration provides a service to manually refresh departure data.</p>"},{"location":"services/#vrrrefresh_departures","title":"vrr.refresh_departures","text":"<p>Manually refresh departure data from the API outside of the normal update interval.</p>"},{"location":"services/#description","title":"Description","text":"<p>This service triggers an immediate API call to fetch the latest departure information. Use this when you need up-to-date data without waiting for the next scheduled update.</p>"},{"location":"services/#parameters","title":"Parameters","text":"Parameter Required Description <code>entity_id</code> No Specific entity to refresh. If omitted, all VRR entities are refreshed."},{"location":"services/#examples","title":"Examples","text":""},{"location":"services/#refresh-all-sensors","title":"Refresh All Sensors","text":"<pre><code>service: vrr.refresh_departures\n</code></pre>"},{"location":"services/#refresh-specific-sensor","title":"Refresh Specific Sensor","text":"<pre><code>service: vrr.refresh_departures\ndata:\n  entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"services/#refresh-multiple-sensors","title":"Refresh Multiple Sensors","text":"<pre><code>service: vrr.refresh_departures\ndata:\n  entity_id:\n    - sensor.vrr_dusseldorf_hauptbahnhof\n    - sensor.vrr_essen_hauptbahnhof\n</code></pre>"},{"location":"services/#use-cases","title":"Use Cases","text":""},{"location":"services/#button-card-for-manual-refresh","title":"Button Card for Manual Refresh","text":"<p>Create a button in your dashboard to manually refresh data:</p> <pre><code>type: button\nname: Refresh Departures\nicon: mdi:refresh\ntap_action:\n  action: call-service\n  service: vrr.refresh_departures\n  service_data:\n    entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"services/#automation-refresh-when-arriving-home","title":"Automation: Refresh When Arriving Home","text":"<pre><code>automation:\n  - alias: \"Refresh departures when arriving home\"\n    trigger:\n      - platform: state\n        entity_id: person.john\n        to: home\n    action:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"services/#automation-refresh-before-morning-commute","title":"Automation: Refresh Before Morning Commute","text":"<pre><code>automation:\n  - alias: \"Refresh departures before commute\"\n    trigger:\n      - platform: time\n        at: \"07:00:00\"\n    condition:\n      - condition: time\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n</code></pre>"},{"location":"services/#script-refresh-and-notify","title":"Script: Refresh and Notify","text":"<pre><code>script:\n  refresh_and_notify_departures:\n    alias: \"Refresh and Notify Departures\"\n    sequence:\n      - service: vrr.refresh_departures\n        data:\n          entity_id: sensor.vrr_dusseldorf_hauptbahnhof\n      - delay:\n          seconds: 2\n      - service: notify.mobile_app\n        data:\n          title: \"Next Departure\"\n          message: &gt;\n            {{ states('sensor.vrr_dusseldorf_hauptbahnhof') }} -\n            {{ state_attr('sensor.vrr_dusseldorf_hauptbahnhof', 'next_departure_minutes') }} min\n</code></pre>"},{"location":"services/#rate-limiting-considerations","title":"Rate Limiting Considerations","text":"<p>Warning</p> <p>While the refresh service bypasses the normal update interval, it still counts against the daily API rate limit.</p> <ul> <li>Each refresh counts as one API call</li> <li>The integration tracks daily API calls</li> <li>If the rate limit is reached, refreshes will fail</li> <li>A repair issue will be created if rate limiting is triggered</li> </ul>"},{"location":"services/#best-practices","title":"Best Practices","text":"<ol> <li>Don't call too frequently - Give time for API response before triggering again</li> <li>Use in specific scenarios - Arriving home, before leaving, etc.</li> <li>Combine with normal updates - Don't rely solely on manual refreshes</li> <li>Monitor API usage - Check the diagnostics for call counts</li> </ol>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>This guide helps you diagnose and resolve common issues with the Public Transport Integration.</p>"},{"location":"troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"troubleshooting/#no-departures-state","title":"\"No departures\" State","text":"<p>Symptoms: Sensor shows \"No departures\" even when the station is active.</p> <p>Possible Causes:</p> <ol> <li>Invalid Station ID: The station ID may be incorrect or have changed</li> <li>API Issues: The provider's API may be temporarily unavailable</li> <li>Filter Too Restrictive: Transportation type filters may exclude all departures</li> <li>Off-Peak Hours: Some stations have no service during certain hours</li> </ol> <p>Solutions:</p> <ol> <li>Verify the station exists and is spelled correctly</li> <li>Check the provider's API status</li> <li>Remove transportation type filters temporarily</li> <li>Enable debug logging to see API responses</li> </ol>"},{"location":"troubleshooting/#api-rate-limit-reached","title":"API Rate Limit Reached","text":"<p>Symptoms: Integration stops updating, repair issue created.</p> <p>Possible Causes:</p> <ul> <li>Too many sensors configured</li> <li>Scan interval too low</li> <li>Too many manual refreshes</li> </ul> <p>Solutions:</p> <ol> <li>Increase the scan interval (e.g., from 60s to 120s)</li> <li>Reduce the number of configured sensors</li> <li>Wait until the next day (limits reset daily)</li> </ol>"},{"location":"troubleshooting/#unknown-transportation-types","title":"\"Unknown\" Transportation Types","text":"<p>Symptoms: Debug logs show \"Unknown transport class X\".</p> <p>Cause: The provider uses a transport class not yet mapped in the integration.</p> <p>Solution: Report the issue on GitHub with:</p> <ul> <li>The provider you're using</li> <li>The unknown class number</li> <li>The type of transport it should represent</li> </ul>"},{"location":"troubleshooting/#connection-errors","title":"Connection Errors","text":"<p>Symptoms: \"API connection error\" or timeout messages.</p> <p>Possible Causes:</p> <ul> <li>Network connectivity issues</li> <li>Provider API downtime</li> <li>Firewall blocking connections</li> </ul> <p>Solutions:</p> <ol> <li>Check your internet connection</li> <li>Verify the provider's API is accessible</li> <li>Check for firewall rules blocking outgoing connections</li> </ol>"},{"location":"troubleshooting/#debug-logging","title":"Debug Logging","text":"<p>Enable debug logging to see detailed information about API calls and responses.</p> <p>Add to your <code>configuration.yaml</code>:</p> <pre><code>logger:\n  default: warning\n  logs:\n    custom_components.vrr: debug\n</code></pre> <p>After restarting Home Assistant, check the logs for detailed information.</p>"},{"location":"troubleshooting/#what-to-look-for","title":"What to Look For","text":"<ul> <li>API URLs: Verify the correct endpoint is being called</li> <li>Response Status: Look for non-200 status codes</li> <li>Response Content: Check if the API returns expected data</li> <li>Transport Class Mapping: See how departures are being classified</li> </ul>"},{"location":"troubleshooting/#diagnostics","title":"Diagnostics","text":"<p>The integration supports Home Assistant's diagnostics feature for easier troubleshooting.</p>"},{"location":"troubleshooting/#how-to-download-diagnostics","title":"How to Download Diagnostics","text":"<ol> <li>Go to Settings &gt; Devices &amp; Services</li> <li>Find your VRR integration</li> <li>Click on the integration</li> <li>Click the 3 dots menu</li> <li>Select Download Diagnostics</li> </ol>"},{"location":"troubleshooting/#diagnostics-contents","title":"Diagnostics Contents","text":"<p>The diagnostics file contains:</p> <ul> <li>Configuration details (anonymized)</li> <li>Coordinator status</li> <li>API call statistics</li> <li>Sample API response structure</li> <li>Last update information</li> </ul> <p>This information is helpful when reporting issues on GitHub.</p>"},{"location":"troubleshooting/#provider-specific-issues","title":"Provider-Specific Issues","text":""},{"location":"troubleshooting/#vrr-kvv-hvv","title":"VRR / KVV / HVV","text":"<p>Stop not found: Try different spellings or include the city name.</p> <pre><code>\"Hauptbahnhof\" \u2192 \"D\u00fcsseldorf Hauptbahnhof\"\n\"Hbf\" \u2192 \"Hauptbahnhof\"\n</code></pre> <p>Platform information missing: Some stops don't provide platform data in the API response.</p>"},{"location":"troubleshooting/#trafiklab-sweden","title":"Trafiklab (Sweden)","text":"<p>401 Authentication Error:</p> <ol> <li>Verify your API key is correct</li> <li>Check that the key is active in your Trafiklab project</li> <li>Ensure you're using the Realtime API key</li> </ol> <p>Empty Results: Use Swedish names and spellings for locations.</p>"},{"location":"troubleshooting/#nta-ireland","title":"NTA (Ireland)","text":"<p>No Departures Found:</p> <ol> <li>Verify the stop ID format is correct</li> <li>GTFS stop IDs may differ from displayed stop numbers</li> <li>Check that the stop has active services</li> </ol> <p>Secondary Key Fallback: If primary key fails, the integration automatically tries the secondary key.</p>"},{"location":"troubleshooting/#api-testing","title":"API Testing","text":""},{"location":"troubleshooting/#finding-station-ids","title":"Finding Station IDs","text":""},{"location":"troubleshooting/#vrr","title":"VRR","text":"<p>Use the STOPFINDER API:</p> <pre><code>https://openservice-test.vrr.de/static03/XML_STOPFINDER_REQUEST?outputFormat=RapidJSON&amp;locationServerActive=1&amp;type_sf=stop&amp;name_sf=D\u00fcsseldorf%20Hauptbahnhof\n</code></pre>"},{"location":"troubleshooting/#testing-departures","title":"Testing Departures","text":"<p>VRR/KVV/HVV using Station ID:</p> <pre><code>https://openservice-test.vrr.de/static03/XML_DM_REQUEST?outputFormat=RapidJSON&amp;stateless=1&amp;type_dm=any&amp;name_dm=20018235&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre> <p>VRR/KVV/HVV using Place and Name:</p> <pre><code>https://openservice-test.vrr.de/static03/XML_DM_REQUEST?outputFormat=RapidJSON&amp;place_dm=D\u00fcsseldorf&amp;type_dm=stop&amp;name_dm=Hauptbahnhof&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre>"},{"location":"troubleshooting/#faq","title":"FAQ","text":""},{"location":"troubleshooting/#can-i-monitor-multiple-stops","title":"Can I monitor multiple stops?","text":"<p>Yes! Add the integration multiple times, once for each stop.</p>"},{"location":"troubleshooting/#why-are-some-departures-missing","title":"Why are some departures missing?","text":"<p>They may be filtered by the transportation type setting. Check your configuration options.</p>"},{"location":"troubleshooting/#how-often-does-data-update","title":"How often does data update?","text":"<p>Based on your configured scan interval (default: 60 seconds).</p>"},{"location":"troubleshooting/#whats-the-difference-between-planned-and-departure-time","title":"What's the difference between planned and departure time?","text":"<ul> <li>Planned time: The scheduled departure time</li> <li>Departure time: The actual/estimated departure time (includes delays)</li> </ul>"},{"location":"troubleshooting/#why-is-my-delay-sensor-always-off","title":"Why is my delay sensor always off?","text":"<p>The binary sensor only activates when delays exceed 5 minutes.</p>"},{"location":"troubleshooting/#reporting-issues","title":"Reporting Issues","text":"<p>When reporting issues on GitHub, please include:</p> <ol> <li>Home Assistant version</li> <li>Integration version</li> <li>Provider you're using</li> <li>Debug logs (with sensitive data removed)</li> <li>Diagnostics file (if possible)</li> <li>Steps to reproduce the issue</li> </ol>"},{"location":"troubleshooting/#sensitive-data","title":"Sensitive Data","text":"<p>Before sharing logs or diagnostics:</p> <ul> <li>Remove or replace API keys</li> <li>Remove personal location information if desired</li> <li>Check for any other sensitive data</li> </ul>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<ol> <li>Check this troubleshooting guide first</li> <li>Search existing GitHub Issues</li> <li>Create a new issue with detailed information</li> </ol>"},{"location":"providers/","title":"Providers Overview","text":"<p>The Public Transport Integration supports multiple transit providers across Europe. Each provider has its own API and data format, but the integration normalizes all data into a consistent format.</p>"},{"location":"providers/#provider-comparison","title":"Provider Comparison","text":"Feature VRR KVV HVV Trafiklab NTA Region NRW, Germany Karlsruhe, Germany Hamburg, Germany Sweden Ireland API Key No No No Yes (free) Yes (free) Real-time Data Yes Yes Yes Yes Yes Delay Information Yes Yes Yes Yes Yes Platform Info Yes Yes Yes Yes Limited Stop Search Autocomplete Autocomplete Autocomplete Autocomplete Stop ID"},{"location":"providers/#timezone-handling","title":"Timezone Handling","text":"<p>Each provider uses its local timezone for departure times:</p> Provider Timezone VRR Europe/Berlin KVV Europe/Berlin HVV Europe/Berlin Trafiklab Europe/Stockholm NTA Europe/Dublin"},{"location":"providers/#transport-type-mapping","title":"Transport Type Mapping","text":"<p>Different providers use different internal classification systems. The integration maps these to a unified set of transport types:</p>"},{"location":"providers/#unified-transport-types","title":"Unified Transport Types","text":"Type Description Icon <code>train</code> Long-distance and regional trains mdi:train <code>subway</code> Subway/Metro/U-Bahn mdi:subway-variant <code>tram</code> Tram/Streetcar mdi:tram <code>bus</code> All bus services mdi:bus-clock <code>ferry</code> Ferry/Water transport mdi:ferry <code>taxi</code> Taxi/On-demand mdi:taxi"},{"location":"providers/#vrrkvv-transport-classes","title":"VRR/KVV Transport Classes","text":"Class Type Description 0, 1 train Legacy trains 2, 3 subway Subway/Metro 4 tram Tram 5-8, 11 bus Various bus types 9 ferry Ferry 10 taxi Taxi 13 train Regional (RE) 15 train InterCity (IC) 16 train ICE"},{"location":"providers/#hvv-transport-classes","title":"HVV Transport Classes","text":"Class Type Description 0 train High-speed trains 1, 2 subway U-Bahn 3, 4 tram S-Bahn 5-8 bus Various bus types 9 ferry Ferry"},{"location":"providers/#trafiklab-transport-modes","title":"Trafiklab Transport Modes","text":"Mode Type TRAIN train METRO subway TRAM tram BUS bus FERRY ferry TAXI taxi"},{"location":"providers/#nta-gtfs-route-types","title":"NTA GTFS Route Types","text":"Route Type Type Description 0, 5, 6 tram Tram/Light Rail 1 subway Subway/Metro 2, 7 train Rail 3 bus Bus 4 ferry Ferry"},{"location":"providers/#api-rate-limiting","title":"API Rate Limiting","text":"<p>The integration implements intelligent rate limiting to prevent overloading provider APIs:</p> <ul> <li>Daily limit: 800 API calls per day (with buffer)</li> <li>Retry logic: Exponential backoff on errors</li> <li>Timeout: 10 seconds per API call</li> <li>Max retries: 3 attempts per update</li> </ul> <p>Info</p> <p>If rate limits are reached, the integration will create a repair issue in Home Assistant to notify you.</p>"},{"location":"providers/hvv/","title":"HVV (Hamburger Verkehrsverbund)","text":"<p>HVV is the transit authority for the Hamburg metropolitan area in Germany.</p>"},{"location":"providers/hvv/#coverage-area","title":"Coverage Area","text":"<ul> <li>Hamburg</li> <li>Parts of Lower Saxony</li> <li>Parts of Schleswig-Holstein</li> </ul>"},{"location":"providers/hvv/#api-details","title":"API Details","text":"Property Value Base URL <code>https://hvv.efa.de/efa/</code> API Key Not required Timezone Europe/Berlin"},{"location":"providers/hvv/#transport-types","title":"Transport Types","text":"Class Type Description 0 train High-speed trains 1, 2 subway U-Bahn 3, 4 tram S-Bahn 5-8 bus Various bus types (Metrobus, Schnellbus, etc.) 9 ferry Hafenf\u00e4hre (Harbor Ferry)"},{"location":"providers/hvv/#configuration","title":"Configuration","text":""},{"location":"providers/hvv/#setup-steps","title":"Setup Steps","text":"<ol> <li>Select HVV as provider</li> <li>Search for your stop (e.g., \"Hamburg Hauptbahnhof\")</li> <li>Select the stop from the list</li> <li>Configure departure count and filters</li> </ol>"},{"location":"providers/hvv/#example-stops","title":"Example Stops","text":"<ul> <li>Hamburg Hauptbahnhof</li> <li>Hamburg Altona</li> <li>Hamburg Jungfernstieg</li> <li>Hamburg Landungsbr\u00fccken</li> </ul>"},{"location":"providers/hvv/#special-features","title":"Special Features","text":""},{"location":"providers/hvv/#ferry-services","title":"Ferry Services","text":"<p>HVV operates harbor ferry services (Hafenf\u00e4hren) that are part of the regular transit network. These are included with your HVV ticket and show up as <code>ferry</code> transport type.</p>"},{"location":"providers/hvv/#platform-information","title":"Platform Information","text":"<p>Platform information is extracted from <code>location.properties.platform</code> in the API response.</p>"},{"location":"providers/hvv/#real-time-detection","title":"Real-time Detection","text":"<p>HVV real-time data is detected by comparing <code>departureTimePlanned</code> with <code>departureTimeEstimated</code>.</p>"},{"location":"providers/hvv/#api-response-example","title":"API Response Example","text":"<pre><code>{\n  \"stopEvents\": [\n    {\n      \"location\": {\n        \"name\": \"Stadionstra\u00dfe\",\n        \"properties\": {\n          \"stopId\": \"28582004\",\n          \"platform\": \"1\"\n        }\n      },\n      \"departureTimePlanned\": \"2025-06-22T20:00:00Z\",\n      \"transportation\": {\n        \"number\": \"2\",\n        \"description\": \"Berliner Tor &gt; Hbf. &gt; Altona &gt; Schenefeld\",\n        \"product\": {\n          \"class\": 5,\n          \"name\": \"Bus\"\n        },\n        \"destination\": {\n          \"name\": \"Schenefeld, Schenefelder Platz\"\n        }\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"providers/hvv/#api-urls","title":"API URLs","text":""},{"location":"providers/hvv/#stop-search","title":"Stop Search","text":"<pre><code>https://hvv.efa.de/efa/XML_STOPFINDER_REQUEST?outputFormat=RapidJSON&amp;locationServerActive=1&amp;type_sf=stop&amp;name_sf=Hamburg%20Hauptbahnhof\n</code></pre>"},{"location":"providers/hvv/#departures","title":"Departures","text":"<pre><code>https://hvv.efa.de/efa/XML_DM_REQUEST?outputFormat=RapidJSON&amp;stateless=1&amp;type_dm=any&amp;name_dm=STATION_ID&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre>"},{"location":"providers/kvv/","title":"KVV (Karlsruher Verkehrsverbund)","text":"<p>KVV is the transit authority for the Karlsruhe region in Baden-W\u00fcrttemberg, Germany.</p>"},{"location":"providers/kvv/#coverage-area","title":"Coverage Area","text":"<ul> <li>Karlsruhe</li> <li>Rastatt</li> <li>Ettlingen</li> <li>Bruchsal</li> <li>And surrounding areas</li> </ul>"},{"location":"providers/kvv/#api-details","title":"API Details","text":"Property Value Base URL <code>https://projekte.kvv-efa.de/sl3-alone/</code> API Key Not required Timezone Europe/Berlin"},{"location":"providers/kvv/#transport-types","title":"Transport Types","text":"<p>KVV uses the same transport class mapping as VRR:</p> Class Type Description 0, 1 train Trains 2, 3 subway Stadtbahn 4 tram Tram 5-8, 11 bus Bus services 9 ferry Ferry"},{"location":"providers/kvv/#configuration","title":"Configuration","text":""},{"location":"providers/kvv/#setup-steps","title":"Setup Steps","text":"<ol> <li>Select KVV as provider</li> <li>Search for your stop (e.g., \"Karlsruhe Hauptbahnhof\")</li> <li>Select the stop from the list</li> <li>Configure departure count and filters</li> </ol>"},{"location":"providers/kvv/#example-stops","title":"Example Stops","text":"<ul> <li>Karlsruhe Hauptbahnhof</li> <li>Karlsruhe Marktplatz</li> <li>Karlsruhe Durlacher Tor</li> <li>Ettlingen Stadt</li> </ul>"},{"location":"providers/kvv/#special-features","title":"Special Features","text":""},{"location":"providers/kvv/#tram-train-system","title":"Tram-Train System","text":"<p>KVV operates a unique tram-train system where light rail vehicles can travel on both city tram lines and regional rail tracks. This means:</p> <ul> <li>S-Bahn lines operate as tram in the city center</li> <li>Same vehicle type serves urban and suburban areas</li> </ul>"},{"location":"providers/kvv/#platform-information","title":"Platform Information","text":"<p>Platform information is extracted from the <code>location.disassembledName</code> field in the API response.</p>"},{"location":"providers/kvv/#api-urls","title":"API URLs","text":""},{"location":"providers/kvv/#stop-search","title":"Stop Search","text":"<pre><code>https://projekte.kvv-efa.de/sl3-alone/XML_STOPFINDER_REQUEST?outputFormat=RapidJSON&amp;locationServerActive=1&amp;type_sf=stop&amp;name_sf=Karlsruhe%20Hauptbahnhof\n</code></pre>"},{"location":"providers/kvv/#departures","title":"Departures","text":"<pre><code>https://projekte.kvv-efa.de/sl3-alone/XML_DM_REQUEST?outputFormat=RapidJSON&amp;stateless=1&amp;type_dm=any&amp;name_dm=STATION_ID&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre>"},{"location":"providers/nta/","title":"NTA (National Transport Authority, Ireland)","text":"<p>NTA provides access to Irish public transport data through the GTFS-Realtime API.</p>"},{"location":"providers/nta/#coverage-area","title":"Coverage Area","text":"<ul> <li>All of Ireland</li> <li>Dublin Bus</li> <li>Bus \u00c9ireann</li> <li>Go-Ahead Ireland</li> <li>Luas (Dublin Tram)</li> <li>Iarnr\u00f3d \u00c9ireann (Irish Rail)</li> </ul>"},{"location":"providers/nta/#api-details","title":"API Details","text":"Property Value Base URL <code>https://api.nationaltransport.ie/gtfsr</code> API Key Required (free) Timezone Europe/Dublin Data Format GTFS-Realtime (JSON)"},{"location":"providers/nta/#api-key","title":"API Key","text":""},{"location":"providers/nta/#getting-an-api-key","title":"Getting an API Key","text":"<ol> <li>Register at developer.nationaltransport.ie</li> <li>Subscribe to the \"GTFS-Realtime\" API</li> <li>You will receive a Primary and Secondary API key</li> <li>Enter the Primary API key during integration setup (required)</li> <li>Optionally enter the Secondary API key (used as fallback)</li> </ol> <p>Tip</p> <p>The Secondary API key is optional but recommended as a fallback if the Primary key fails.</p>"},{"location":"providers/nta/#api-key-usage","title":"API Key Usage","text":"<ul> <li>Primary Key: Required for all API calls</li> <li>Secondary Key: Automatic fallback if Primary returns 401</li> </ul>"},{"location":"providers/nta/#transport-types","title":"Transport Types","text":"GTFS Route Type Type Description 0, 5, 6 tram Tram/Light Rail (Luas) 1 subway Subway/Metro 2, 7 train Rail (Iarnr\u00f3d \u00c9ireann) 3 bus Bus services 4 ferry Ferry"},{"location":"providers/nta/#configuration","title":"Configuration","text":""},{"location":"providers/nta/#setup-steps","title":"Setup Steps","text":"<ol> <li>Select NTA as provider</li> <li>Enter your Primary API key (and optionally Secondary key)</li> <li>Enter the stop ID (see below)</li> <li>Configure departure count and filters</li> </ol>"},{"location":"providers/nta/#finding-stop-ids","title":"Finding Stop IDs","text":"<p>NTA uses GTFS stop IDs. To find a stop ID:</p> <ol> <li>Visit Transport for Ireland</li> <li>Search for your stop</li> <li>The stop ID is in the URL or stop information</li> </ol> <p>Common stop ID formats:</p> <ul> <li>Dublin Bus: <code>8220DB000001</code></li> <li>Luas: <code>LUAS1</code>, <code>LUAS2</code>, etc.</li> <li>Irish Rail: Station codes</li> </ul>"},{"location":"providers/nta/#example-stops","title":"Example Stops","text":"<ul> <li>Dublin Connolly Station</li> <li>Heuston Station</li> <li>Dublin Bus stops (by stop number)</li> <li>Luas stops</li> </ul>"},{"location":"providers/nta/#special-features","title":"Special Features","text":""},{"location":"providers/nta/#gtfs-realtime-format","title":"GTFS-Realtime Format","text":"<p>NTA uses the GTFS-Realtime standard, which provides:</p> <ul> <li>Trip updates with delays</li> <li>Real-time arrival predictions</li> <li>Service alerts (future feature)</li> </ul>"},{"location":"providers/nta/#multiple-operators","title":"Multiple Operators","text":"<p>The integration handles data from all Irish operators:</p> <ul> <li>Dublin Bus: City and suburban buses</li> <li>Bus \u00c9ireann: Regional and intercity buses</li> <li>Go-Ahead Ireland: Dublin commuter buses</li> <li>Luas: Dublin light rail (Red and Green lines)</li> <li>Iarnr\u00f3d \u00c9ireann: National rail services</li> </ul>"},{"location":"providers/nta/#delay-calculation","title":"Delay Calculation","text":"<p>Delays are calculated from GTFS-RT <code>trip_update.stop_time_update.departure.delay</code> field, provided in seconds and converted to minutes.</p>"},{"location":"providers/nta/#api-information","title":"API Information","text":""},{"location":"providers/nta/#endpoint","title":"Endpoint","text":"<pre><code>https://api.nationaltransport.ie/gtfsr/v2/TripUpdates?format=json\n</code></pre>"},{"location":"providers/nta/#authentication","title":"Authentication","text":"<p>API key is passed via the <code>x-api-key</code> header:</p> <pre><code>x-api-key: YOUR_PRIMARY_API_KEY\n</code></pre>"},{"location":"providers/nta/#response-structure","title":"Response Structure","text":"<pre><code>{\n  \"header\": {\n    \"gtfs_realtime_version\": \"2.0\",\n    \"timestamp\": 1234567890\n  },\n  \"entity\": [\n    {\n      \"id\": \"trip_id\",\n      \"trip_update\": {\n        \"trip\": {\n          \"trip_id\": \"...\",\n          \"route_id\": \"...\"\n        },\n        \"stop_time_update\": [\n          {\n            \"stop_id\": \"8220DB000001\",\n            \"departure\": {\n              \"delay\": 120,\n              \"time\": 1234567890\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"providers/nta/#troubleshooting","title":"Troubleshooting","text":""},{"location":"providers/nta/#api-key-issues","title":"API Key Issues","text":"<p>If you get a 401 error:</p> <ol> <li>Verify your Primary API key is correct</li> <li>Check that you've subscribed to the GTFS-Realtime API</li> <li>Try the Secondary key if configured</li> </ol>"},{"location":"providers/nta/#no-departures-found","title":"No Departures Found","text":"<p>If no departures are returned:</p> <ol> <li>Verify the stop ID is correct</li> <li>Check that the stop has active services at this time</li> <li>Enable debug logging to see API responses</li> </ol>"},{"location":"providers/trafiklab/","title":"Trafiklab (Sweden)","text":"<p>Trafiklab provides access to Swedish public transport data through various APIs.</p>"},{"location":"providers/trafiklab/#coverage-area","title":"Coverage Area","text":"<ul> <li>All of Sweden</li> <li>All regional transit operators</li> <li>SJ (national rail)</li> </ul>"},{"location":"providers/trafiklab/#api-details","title":"API Details","text":"Property Value Base URL <code>https://realtime-api.trafiklab.se/v1/</code> API Key Required (free) Timezone Europe/Stockholm"},{"location":"providers/trafiklab/#api-key","title":"API Key","text":""},{"location":"providers/trafiklab/#getting-an-api-key","title":"Getting an API Key","text":"<ol> <li>Register at trafiklab.se</li> <li>Create a new project</li> <li>Select the \"Realtime API\"</li> <li>Copy the API key</li> <li>Enter it during integration setup</li> </ol> <p>Note</p> <p>The API key is free but required. Registration takes just a few minutes.</p>"},{"location":"providers/trafiklab/#api-key-in-configuration","title":"API Key in Configuration","text":"<p>The API key is stored securely in your Home Assistant configuration and is used for:</p> <ul> <li>Stop/station search</li> <li>Fetching real-time departures</li> </ul>"},{"location":"providers/trafiklab/#transport-types","title":"Transport Types","text":"Mode Type Description TRAIN train Commuter and regional trains METRO subway Stockholm Metro (Tunnelbana) TRAM tram Trams (G\u00f6teborg, Norrk\u00f6ping, etc.) BUS bus All bus services FERRY ferry Ferry services TAXI taxi Taxi/On-demand"},{"location":"providers/trafiklab/#configuration","title":"Configuration","text":""},{"location":"providers/trafiklab/#setup-steps","title":"Setup Steps","text":"<ol> <li>Select Trafiklab as provider</li> <li>Enter your API key</li> <li>Search for your stop (e.g., \"Stockholm Centralstation\")</li> <li>Select the stop from the list</li> <li>Configure departure count and filters</li> </ol>"},{"location":"providers/trafiklab/#example-stops","title":"Example Stops","text":"<ul> <li>Stockholm Centralstation</li> <li>G\u00f6teborg Centralstation</li> <li>Malm\u00f6 Centralstation</li> <li>Uppsala Centralstation</li> </ul>"},{"location":"providers/trafiklab/#special-features","title":"Special Features","text":""},{"location":"providers/trafiklab/#nationwide-coverage","title":"Nationwide Coverage","text":"<p>Trafiklab aggregates data from all Swedish transit operators, providing a unified view of:</p> <ul> <li>SJ (national rail)</li> <li>SL (Stockholm)</li> <li>V\u00e4sttrafik (Gothenburg region)</li> <li>Sk\u00e5netrafiken (Malm\u00f6 region)</li> <li>And many more</li> </ul>"},{"location":"providers/trafiklab/#real-time-data","title":"Real-time Data","text":"<p>Real-time data is available when the <code>is_realtime</code> flag is true in the API response. This indicates live tracking data rather than scheduled times.</p>"},{"location":"providers/trafiklab/#api-urls","title":"API URLs","text":""},{"location":"providers/trafiklab/#stop-search","title":"Stop Search","text":"<pre><code>https://realtime-api.trafiklab.se/v1/stops/name/Stockholm%20Centralstation?key=YOUR_API_KEY\n</code></pre>"},{"location":"providers/trafiklab/#departures","title":"Departures","text":"<pre><code>https://realtime-api.trafiklab.se/v1/departures/STATION_ID?key=YOUR_API_KEY\n</code></pre>"},{"location":"providers/trafiklab/#troubleshooting","title":"Troubleshooting","text":""},{"location":"providers/trafiklab/#api-key-issues","title":"API Key Issues","text":"<p>If you get a 401 error:</p> <ol> <li>Verify your API key is correct</li> <li>Check that the key is active in your Trafiklab project</li> <li>Ensure you're using the Realtime API key (not another API)</li> </ol>"},{"location":"providers/trafiklab/#no-results","title":"No Results","text":"<p>If searches return no results:</p> <ul> <li>Try different spellings</li> <li>Use the Swedish name for the location</li> <li>Check that the stop exists in Trafiklab's database</li> </ul>"},{"location":"providers/vrr/","title":"VRR (Verkehrsverbund Rhein-Ruhr)","text":"<p>VRR is the transit authority for the Rhein-Ruhr metropolitan area in North Rhine-Westphalia, Germany.</p>"},{"location":"providers/vrr/#coverage-area","title":"Coverage Area","text":"<ul> <li>D\u00fcsseldorf</li> <li>Essen</li> <li>Dortmund</li> <li>Duisburg</li> <li>Bochum</li> <li>Wuppertal</li> <li>And surrounding areas</li> </ul>"},{"location":"providers/vrr/#api-details","title":"API Details","text":"Property Value Base URL <code>https://openservice-test.vrr.de/static03/</code> API Key Not required Rate Limit 60,000 calls/day Timezone Europe/Berlin"},{"location":"providers/vrr/#transport-types","title":"Transport Types","text":"Class Type Description 0, 1 train Legacy trains 2, 3 subway U-Bahn 4 tram Tram 5-8, 11 bus Various bus types 9 ferry Ferry 10 taxi Taxi 13 train Regional (RE) 15 train InterCity (IC) 16 train ICE"},{"location":"providers/vrr/#configuration","title":"Configuration","text":""},{"location":"providers/vrr/#setup-steps","title":"Setup Steps","text":"<ol> <li>Select VRR as provider</li> <li>Search for your stop (e.g., \"D\u00fcsseldorf Hauptbahnhof\")</li> <li>Select the stop from the list</li> <li>Configure departure count and filters</li> </ol>"},{"location":"providers/vrr/#example-stops","title":"Example Stops","text":"<ul> <li>D\u00fcsseldorf Hauptbahnhof</li> <li>Essen Hauptbahnhof</li> <li>Dortmund Hauptbahnhof</li> <li>Duisburg Hauptbahnhof</li> </ul>"},{"location":"providers/vrr/#api-urls","title":"API URLs","text":""},{"location":"providers/vrr/#stop-search-stopfinder","title":"Stop Search (STOPFINDER)","text":"<pre><code>https://openservice-test.vrr.de/static03/XML_STOPFINDER_REQUEST?outputFormat=RapidJSON&amp;locationServerActive=1&amp;type_sf=stop&amp;name_sf=D\u00fcsseldorf%20Hauptbahnhof\n</code></pre>"},{"location":"providers/vrr/#departures-dm_request","title":"Departures (DM_REQUEST)","text":"<p>Using Station ID: <pre><code>https://openservice-test.vrr.de/static03/XML_DM_REQUEST?outputFormat=RapidJSON&amp;stateless=1&amp;type_dm=any&amp;name_dm=20018235&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre></p> <p>Using Place and Name: <pre><code>https://openservice-test.vrr.de/static03/XML_DM_REQUEST?outputFormat=RapidJSON&amp;place_dm=D\u00fcsseldorf&amp;type_dm=stop&amp;name_dm=Hauptbahnhof&amp;mode=direct&amp;useRealtime=1&amp;limit=10\n</code></pre></p>"},{"location":"providers/vrr/#features","title":"Features","text":"<ul> <li>Full real-time departure data</li> <li>Delay information in minutes</li> <li>Platform/track information</li> <li>All major transport types supported</li> <li>Fuzzy search with typo tolerance</li> </ul>"}]}